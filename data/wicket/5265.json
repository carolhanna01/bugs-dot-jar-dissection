{
  "files": 1, 
  "singleLine": false, 
  "nb_error": 0, 
  "failing_tests": [
    "FencedFeedbackPanelTest.reAdding:187 null"
  ], 
  "nb_test": 1688, 
  "patch": "diff --git a/wicket-core/src/main/java/org/apache/wicket/feedback/FencedFeedbackPanel.java b/wicket-core/src/main/java/org/apache/wicket/feedback/FencedFeedbackPanel.java\nindex f7df59e..42e1344 100644\n--- a/wicket-core/src/main/java/org/apache/wicket/feedback/FencedFeedbackPanel.java\n+++ b/wicket-core/src/main/java/org/apache/wicket/feedback/FencedFeedbackPanel.java\n@@ -29,13 +29,13 @@ import org.apache.wicket.markup.html.panel.FeedbackPanel;\n  * the nesting of these panels to work correctly without displaying the same feedback message twice.\n  * A constructor that does not takes a fencing component creates a catch-all panel that shows\n  * messages that do not come from inside any fence or from the {@link Session}.\n- * \n+ * <p/>\n  * <h2>IN DEPTH EXPLANATION</h2>\n  * <p>\n  * It is often very useful to have feedback panels that show feedback that comes from inside a\n  * certain container only. For example given a page with the following structure:\n  * </p>\n- * \n+ * <p/>\n  * <pre>\n  * Page\n  *   Form1\n@@ -72,7 +72,7 @@ import org.apache.wicket.markup.html.panel.FeedbackPanel;\n  * fencing component. There is usually one instance of such a panel at the top of the page to\n  * display notifications of success.\n  * </p>\n- * \n+ *\n  * @author igor\n  */\n public class FencedFeedbackPanel extends FeedbackPanel\n@@ -89,7 +89,7 @@ public class FencedFeedbackPanel extends FeedbackPanel\n \t/**\n \t * Creates a catch-all feedback panel that will show messages not coming from any fence,\n \t * including messages coming from {@link Session}\n-\t * \n+\t *\n \t * @param id\n \t */\n \tpublic FencedFeedbackPanel(String id)\n@@ -100,7 +100,7 @@ public class FencedFeedbackPanel extends FeedbackPanel\n \t/**\n \t * Creates a feedback panel that will only show messages if they original from, or inside of,\n \t * the {@code fence} component and not from any inner fence.\n-\t * \n+\t *\n \t * @param id\n \t * @param fence\n \t */\n@@ -111,11 +111,10 @@ public class FencedFeedbackPanel extends FeedbackPanel\n \n \t/**\n \t * Creates a catch-all instance with a filter.\n-\t * \n-\t * @see #FencedFeedbackPanel(String)\n-\t * \n+\t *\n \t * @param id\n \t * @param filter\n+\t * @see #FencedFeedbackPanel(String)\n \t */\n \tpublic FencedFeedbackPanel(String id, IFeedbackMessageFilter filter)\n \t{\n@@ -124,12 +123,11 @@ public class FencedFeedbackPanel extends FeedbackPanel\n \n \t/**\n \t * Creates a fenced feedback panel with a filter.\n-\t * \n-\t * @see #FencedFeedbackPanel(String, Component)\n-\t * \n+\t *\n \t * @param id\n \t * @param fence\n \t * @param filter\n+\t * @see #FencedFeedbackPanel(String, Component)\n \t */\n \tpublic FencedFeedbackPanel(String id, Component fence, IFeedbackMessageFilter filter)\n \t{\n@@ -137,12 +135,17 @@ public class FencedFeedbackPanel extends FeedbackPanel\n \t\tthis.fence = fence;\n \t\tif (fence != null)\n \t\t{\n-\t\t\tInteger count = fence.getMetaData(FENCE_KEY);\n-\t\t\tcount = count == null ? 1 : count + 1;\n-\t\t\tfence.setMetaData(FENCE_KEY, count);\n+\t\t\tincrementFenceCount();\n \t\t}\n \t}\n \n+\tprivate void incrementFenceCount()\n+\t{\n+\t\tInteger count = fence.getMetaData(FENCE_KEY);\n+\t\tcount = count == null ? 1 : count + 1;\n+\t\tfence.setMetaData(FENCE_KEY, count);\n+\t}\n+\n \t@Override\n \tprotected void onRemove()\n \t{\n@@ -151,12 +154,17 @@ public class FencedFeedbackPanel extends FeedbackPanel\n \t\t{\n \t\t\t// decrement the fence count\n \n-\t\t\tInteger count = fence.getMetaData(FENCE_KEY);\n-\t\t\tcount = (count == null || count == 1) ? null : count - 1;\n-\t\t\tfence.setMetaData(FENCE_KEY, count);\n+\t\t\tdecrementFenceCount();\n \t\t}\n \t}\n \n+\tprivate void decrementFenceCount()\n+\t{\n+\t\tInteger count = fence.getMetaData(FENCE_KEY);\n+\t\tcount = (count == null || count == 1) ? null : count - 1;\n+\t\tfence.setMetaData(FENCE_KEY, count);\n+\t}\n+\n \t@Override\n \tprotected FeedbackMessagesModel newFeedbackMessagesModel()\n \t{\n@@ -166,7 +174,7 @@ public class FencedFeedbackPanel extends FeedbackPanel\n \n \t\t\t@Override\n \t\t\tprotected List<FeedbackMessage> collectMessages(Component panel,\n-\t\t\t\tIFeedbackMessageFilter filter)\n+\t\t\t\t\tIFeedbackMessageFilter filter)\n \t\t\t{\n \t\t\t\tif (fence == null)\n \t\t\t\t{\n@@ -177,7 +185,7 @@ public class FencedFeedbackPanel extends FeedbackPanel\n \t\t\t\t\t\t@Override\n \t\t\t\t\t\tprotected boolean shouldRecurseInto(Component component)\n \t\t\t\t\t\t{\n-\t\t\t\t\t\t\treturn component.getMetaData(FENCE_KEY) == null;\n+\t\t\t\t\t\t\treturn !componentIsMarkedAsFence(component);\n \t\t\t\t\t\t}\n \t\t\t\t\t}.collect(filter);\n \t\t\t\t}\n@@ -191,12 +199,29 @@ public class FencedFeedbackPanel extends FeedbackPanel\n \t\t\t\t\t\tprotected boolean shouldRecurseInto(Component component)\n \t\t\t\t\t\t{\n \t\t\t\t\t\t\t// only recurse into components that are not fences\n-\n-\t\t\t\t\t\t\treturn component.getMetaData(FENCE_KEY) == null;\n+\t\t\t\t\t\t\treturn !componentIsMarkedAsFence(component);\n \t\t\t\t\t\t}\n \t\t\t\t\t}.setIncludeSession(false).collect(filter);\n \t\t\t\t}\n \t\t\t}\n \t\t};\n \t}\n+\n+\tprivate boolean componentIsMarkedAsFence(Component component)\n+\t{\n+\t\treturn component.getMetaData(FENCE_KEY) != null;\n+\t}\n+\n+\t@Override\n+\tprotected void onReAdd()\n+\t{\n+\t\tif (this.fence != null)\n+\t\t{\n+\t\t\t// The fence mark is removed when the feedback panel is removed from the hierarchy.\n+\t\t\t// see onRemove().\n+\t\t\t// when the panel is re-added, we recreate the fence mark.\n+\t\t\tincrementFenceCount();\n+\t\t}\n+\t\tsuper.onReAdd();\n+\t}\n }\n", 
  "project": "wicket", 
  "linesAdd": 46, 
  "nb_skipped": 1, 
  "fix_commit": "0eb596df", 
  "nb_failure": 1, 
  "id": "5265", 
  "linesRem": 21
}