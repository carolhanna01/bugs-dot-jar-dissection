{"files": 3, "singleLine": false, "nb_error": 0, "failing_tests": ["testCSSResourceReferenceRespectsMinifiedResourcesDetection(org.apache.wicket.request.resource.PackageResourceReferenceTest): Already minified resource should got its compress flag set to false", "testJavaScriptResourceReferenceRespectsMinifiedResourcesDetection(org.apache.wicket.request.resource.PackageResourceReferenceTest): Already minified resource should got its compress flag set to false"], "nb_test": 1504, "patch": "diff --git a/wicket-core/src/main/java/org/apache/wicket/request/resource/CssResourceReference.java b/wicket-core/src/main/java/org/apache/wicket/request/resource/CssResourceReference.java\nindex 55955d7..7d15d61 100644\n--- a/wicket-core/src/main/java/org/apache/wicket/request/resource/CssResourceReference.java\n+++ b/wicket-core/src/main/java/org/apache/wicket/request/resource/CssResourceReference.java\n@@ -76,8 +76,10 @@ public class CssResourceReference extends PackageResourceReference\n \t@Override\n \tpublic CssPackageResource getResource()\n \t{\n-\t\treturn new CssPackageResource(getScope(), getName(), getLocale(), getStyle(),\n-\t\t\tgetVariation());\n+        final CssPackageResource resource = new CssPackageResource(getScope(), getName(), getLocale(), getStyle(),\n+                getVariation());\n+        removeCompressFlagIfUnnecessary(resource);\n+        return resource;\n \t}\n \n }\ndiff --git a/wicket-core/src/main/java/org/apache/wicket/request/resource/JavaScriptResourceReference.java b/wicket-core/src/main/java/org/apache/wicket/request/resource/JavaScriptResourceReference.java\nindex 43e4a0d..d320f59 100644\n--- a/wicket-core/src/main/java/org/apache/wicket/request/resource/JavaScriptResourceReference.java\n+++ b/wicket-core/src/main/java/org/apache/wicket/request/resource/JavaScriptResourceReference.java\n@@ -78,7 +78,9 @@ public class JavaScriptResourceReference extends PackageResourceReference\n \t@Override\n \tpublic JavaScriptPackageResource getResource()\n \t{\n-\t\treturn new JavaScriptPackageResource(getScope(), getName(), getLocale(), getStyle(),\n-\t\t\tgetVariation());\n+        final JavaScriptPackageResource resource = new JavaScriptPackageResource(getScope(), getName(), getLocale(), getStyle(),\n+                getVariation());\n+        removeCompressFlagIfUnnecessary(resource);\n+        return resource;\n \t}\n }\ndiff --git a/wicket-core/src/main/java/org/apache/wicket/request/resource/PackageResourceReference.java b/wicket-core/src/main/java/org/apache/wicket/request/resource/PackageResourceReference.java\nindex ca248a0..a127aa7 100644\n--- a/wicket-core/src/main/java/org/apache/wicket/request/resource/PackageResourceReference.java\n+++ b/wicket-core/src/main/java/org/apache/wicket/request/resource/PackageResourceReference.java\n@@ -129,16 +129,30 @@ public class PackageResourceReference extends ResourceReference\n \t\t\t\tgetVariation());\n \t\t}\n \n-\t\tString minifiedName = MINIFIED_NAMES_CACHE.get(this);\n-\t\tif (minifiedName != null && minifiedName != NO_MINIFIED_NAME)\n-\t\t{\n-\t\t\tresource.setCompress(false);\n-\t\t}\n-\n-\t\treturn resource;\n-\t}\n-\n-\tprivate ResourceReference.UrlAttributes getUrlAttributes(Locale locale, String style, String variation)\n+        removeCompressFlagIfUnnecessary(resource);\n+\n+        return resource;\n+    }\n+\n+    /**\n+     * Method allowing to remove the compress flag if the resource has been detected as a minified one\n+     * (i.e. ending with .min.EXT)\n+     * This method is to be called by subclasses overriding <code>getResource</code>\n+     * if they want to rely on default minification detection handling\n+     *\n+     * see WICKET-5250 for further explanation\n+     * @param resource resource to check\n+     */\n+    protected void removeCompressFlagIfUnnecessary(final PackageResource resource)\n+    {\n+        String minifiedName = MINIFIED_NAMES_CACHE.get(this);\n+        if (minifiedName != null && minifiedName != NO_MINIFIED_NAME)\n+        {\n+            resource.setCompress(false);\n+        }\n+    }\n+\n+    private ResourceReference.UrlAttributes getUrlAttributes(Locale locale, String style, String variation)\n \t{\n \t\tIResourceStreamLocator locator = Application.get()\n \t\t\t.getResourceSettings()\n", "project": "wicket", "linesAdd": 32, "nb_skipped": 3, "fix_commit": "6122df49", "nb_failure": 2, "id": "5250", "linesRem": 14}