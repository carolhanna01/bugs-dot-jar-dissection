{"nb_failure": 1, "nb_error": 0, "failing_tests": ["StreamTaskTest.testEarlyCanceling:112 Task did not cancel"], "patch": "diff --git a/flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/tasks/StreamTask.java b/flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/tasks/StreamTask.java\nindex 9ab6c10..c9624fc 100644\n--- a/flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/tasks/StreamTask.java\n+++ b/flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/tasks/StreamTask.java\n@@ -146,6 +146,9 @@ public abstract class StreamTask<OUT, Operator extends StreamOperator<OUT>>\n \t/** Flag to mark the task \"in operation\", in which case check\n \t * needs to be initialized to true, so that early cancel() before invoke() behaves correctly */\n \tprivate volatile boolean isRunning;\n+\t\n+\t/** Flag to mark this task as canceled */\n+\tprivate volatile boolean canceled;\n \n \tprivate long recoveryTimestamp;\n \n@@ -191,6 +194,11 @@ public abstract class StreamTask<OUT, Operator extends StreamOperator<OUT>>\n \t\t\t// task specific initialization\n \t\t\tinit();\n \t\t\t\n+\t\t\t// save the work of reloadig state, etc, if the task is already canceled\n+\t\t\tif (canceled) {\n+\t\t\t\tthrow new CancelTaskException();\n+\t\t\t}\n+\t\t\t\n \t\t\t// -------- Invoke --------\n \t\t\tLOG.debug(\"Invoking {}\", getName());\n \t\t\t\n@@ -205,7 +213,12 @@ public abstract class StreamTask<OUT, Operator extends StreamOperator<OUT>>\n \t\t\t\topenAllOperators();\n \t\t\t}\n \n-\t\t\t// let the task do its work\n+\t\t\t// final check to exit early before starting to run\n+\t\t\tif (canceled) {\n+\t\t\t\tthrow new CancelTaskException();\n+\t\t\t}\n+\n+\t\t\t\t// let the task do its work\n \t\t\tisRunning = true;\n \t\t\trun();\n \t\t\tisRunning = false;\n@@ -290,6 +303,7 @@ public abstract class StreamTask<OUT, Operator extends StreamOperator<OUT>>\n \t@Override\n \tpublic final void cancel() throws Exception {\n \t\tisRunning = false;\n+\t\tcanceled = true;\n \t\tcancelTask();\n \t}\n \n@@ -297,6 +311,10 @@ public abstract class StreamTask<OUT, Operator extends StreamOperator<OUT>>\n \t\treturn isRunning;\n \t}\n \t\n+\tpublic final boolean isCanceled() {\n+\t\treturn canceled;\n+\t}\n+\t\n \tprivate void openAllOperators() throws Exception {\n \t\tfor (StreamOperator<?> operator : operatorChain.getAllOperators()) {\n \t\t\tif (operator != null) {\n", "nb_test": 243, "nb_skipped": 5, "fix_commit": "8fc7e7af", "id": "3314"}