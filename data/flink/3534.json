{
  "files": 2, 
  "singleLine": false, 
  "nb_error": 0, 
  "failing_tests": [
    "ExecutionGraphRestartTest.testFailExecutionAfterCancel:539 expected:<CANCELED> but was:<RESTARTING>", 
    "ExecutionVertexCancelTest.testActionsWhileCancelling:552 expected:<CANCELED> but was:<FAILED>", 
    "ExecutionVertexCancelTest.testCancelCallFails:403 expected:<CANCELED> but was:<FAILED>"
  ], 
  "nb_test": 977, 
  "patch": "diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/executiongraph/Execution.java b/flink-runtime/src/main/java/org/apache/flink/runtime/executiongraph/Execution.java\nindex bc75664..6d5832b 100644\n--- a/flink-runtime/src/main/java/org/apache/flink/runtime/executiongraph/Execution.java\n+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/executiongraph/Execution.java\n@@ -797,6 +797,11 @@ public class Execution implements Serializable {\n \t\t\t\treturn false;\n \t\t\t}\n \n+\t\t\tif (current == CANCELING) {\n+\t\t\t\tcancelingComplete();\n+\t\t\t\treturn false;\n+\t\t\t}\n+\n \t\t\tif (transitionState(current, FAILED, t)) {\n \t\t\t\t// success (in a manner of speaking)\n \t\t\t\tthis.failureCause = t;\ndiff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/executiongraph/ExecutionGraph.java b/flink-runtime/src/main/java/org/apache/flink/runtime/executiongraph/ExecutionGraph.java\nindex 0d6de98..ed50bea 100755\n--- a/flink-runtime/src/main/java/org/apache/flink/runtime/executiongraph/ExecutionGraph.java\n+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/executiongraph/ExecutionGraph.java\n@@ -809,7 +809,7 @@ public class ExecutionGraph implements Serializable {\n \tpublic void fail(Throwable t) {\n \t\twhile (true) {\n \t\t\tJobStatus current = state;\n-\t\t\tif (current == JobStatus.FAILED || current == JobStatus.FAILING) {\n+\t\t\tif (current == JobStatus.FAILING || current.isTerminalState()) {\n \t\t\t\treturn;\n \t\t\t}\n \t\t\telse if (transitionState(current, JobStatus.FAILING, t)) {\n", 
  "project": "flink", 
  "linesAdd": 6, 
  "nb_skipped": 1, 
  "fix_commit": "734ba01d", 
  "nb_failure": 3, 
  "id": "3534", 
  "linesRem": 1
}