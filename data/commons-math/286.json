{"nb_failure": 1, "nb_error": 0, "failing_tests": ["testMath286(org.apache.commons.math.optimization.linear.SimplexSolverTest)"], "patch": "diff --git a/src/main/java/org/apache/commons/math/optimization/linear/SimplexTableau.java b/src/main/java/org/apache/commons/math/optimization/linear/SimplexTableau.java\nindex c228ad6..b387767 100644\n--- a/src/main/java/org/apache/commons/math/optimization/linear/SimplexTableau.java\n+++ b/src/main/java/org/apache/commons/math/optimization/linear/SimplexTableau.java\n@@ -270,8 +270,27 @@ class SimplexTableau implements Serializable {\n      * @return the row that the variable is basic in.  null if the column is not basic\n      */\n     private Integer getBasicRow(final int col) {\n+        return getBasicRow(col, true);\n+    }\n+\n+    /**\n+     * Checks whether the given column is basic.\n+     * @param col index of the column to check\n+     * @return the row that the variable is basic in.  null if the column is not basic\n+     */\n+    private Integer getBasicRowForSolution(final int col) {\n+        return getBasicRow(col, false);\n+    }\n+    \n+    /**\n+     * Checks whether the given column is basic.\n+     * @param col index of the column to check\n+     * @return the row that the variable is basic in.  null if the column is not basic\n+     */\n+    private Integer getBasicRow(final int col, boolean ignoreObjectiveRows) {\n         Integer row = null;\n-        for (int i = getNumObjectiveFunctions(); i < getHeight(); i++) {\n+        int start = ignoreObjectiveRows ? getNumObjectiveFunctions() : 0;\n+        for (int i = start; i < getHeight(); i++) {\n             if (MathUtils.equals(getEntry(i, col), 1.0, epsilon) && (row == null)) {\n                 row = i;\n             } else if (!MathUtils.equals(getEntry(i, col), 0.0, epsilon)) {\n@@ -318,24 +337,23 @@ class SimplexTableau implements Serializable {\n      * @return current solution\n      */\n     protected RealPointValuePair getSolution() {\n-        double[] coefficients = new double[getOriginalNumDecisionVariables()];\n-        Integer basicRow =\n-            getBasicRow(getNumObjectiveFunctions() + getOriginalNumDecisionVariables());\n-        double mostNegative = basicRow == null ? 0 : getEntry(basicRow, getRhsOffset());\n-        Set<Integer> basicRows = new HashSet<Integer>();\n-        for (int i = 0; i < coefficients.length; i++) {\n-            basicRow = getBasicRow(getNumObjectiveFunctions() + i);\n-            if (basicRows.contains(basicRow)) {\n-                // if multiple variables can take a given value \n-                // then we choose the first and set the rest equal to 0\n-                coefficients[i] = 0;\n-            } else {\n-                basicRows.add(basicRow);\n-                coefficients[i] =\n-                    (basicRow == null ? 0 : getEntry(basicRow, getRhsOffset())) -\n-                    (restrictToNonNegative ? 0 : mostNegative);\n-            }\n-        }\n+      double[] coefficients = new double[getOriginalNumDecisionVariables()];\n+      Integer negativeVarBasicRow = getBasicRowForSolution(getNegativeDecisionVariableOffset());\n+      double mostNegative = negativeVarBasicRow == null ? 0 : getEntry(negativeVarBasicRow, getRhsOffset());\n+      Set<Integer> basicRows = new HashSet<Integer>();\n+      for (int i = 0; i < coefficients.length; i++) {\n+          Integer basicRow = getBasicRowForSolution(getNumObjectiveFunctions() + i);\n+          if (basicRows.contains(basicRow)) {\n+              // if multiple variables can take a given value \n+              // then we choose the first and set the rest equal to 0\n+              coefficients[i] = 0;\n+          } else {\n+              basicRows.add(basicRow);\n+              coefficients[i] =\n+                  (basicRow == null ? 0 : getEntry(basicRow, getRhsOffset())) -\n+                  (restrictToNonNegative ? 0 : mostNegative);\n+          }\n+      }\n         return new RealPointValuePair(coefficients, f.getValue(coefficients));\n     }\n \n@@ -430,6 +448,15 @@ class SimplexTableau implements Serializable {\n     protected final int getRhsOffset() {\n         return getWidth() - 1;\n     }\n+    \n+    /**\n+     * Returns the offset of the extra decision variable added when there is a\n+     * negative decision variable in the original problem.\n+     * @return the offset of x-\n+     */\n+    protected final int getNegativeDecisionVariableOffset() {\n+      return getNumObjectiveFunctions() + getOriginalNumDecisionVariables();\n+    }\n \n     /**\n      * Get the number of decision variables.\n", "nb_test": 2040, "nb_skipped": 0, "fix_commit": "dbdff075", "id": "286"}