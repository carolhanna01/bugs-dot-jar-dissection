{"files": 1, "singleLine": false, "nb_error": 0, "failing_tests": ["rollback(org.apache.jackrabbit.oak.plugins.document.DocumentNodeStoreTest): document with id 2:/foo/node does not exist"], "nb_test": 1579, "patch": "diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/Commit.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/Commit.java\nindex 75510da..93b4bd0 100644\n--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/Commit.java\n+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/Commit.java\n@@ -408,7 +408,9 @@ public class Commit {\n             store.createOrUpdate(NODES, reverse);\n         }\n         for (UpdateOp op : newDocuments) {\n-            store.remove(NODES, op.id);\n+            UpdateOp reverse = op.getReverseOperation();\n+            NodeDocument.unsetLastRev(reverse, revision.getClusterId());\n+            store.createOrUpdate(NODES, reverse);\n         }\n         UpdateOp removeCollision = new UpdateOp(commitRoot.getId(), false);\n         NodeDocument.removeCollision(removeCollision, revision);\n", "project": "jackrabbit-oak", "linesAdd": 3, "nb_skipped": 7, "fix_commit": "dde7de85", "nb_failure": 1, "id": "1467", "linesRem": 1}