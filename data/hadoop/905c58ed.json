{
  "project": "hadoop",
  "jira_id": "2187",
  "commit": "905c58ed",
  "classification": {
    "singleLine": false
  },
  "patch": "diff --git a/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager/src/main/java/org/apache/hadoop/yarn/server/resourcemanager/scheduler/fair/AllocationConfiguration.java b/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager/src/main/java/org/apache/hadoop/yarn/server/resourcemanager/scheduler/fair/AllocationConfiguration.java\nindex 237cad29c1..d4ba88faf1 100644\n--- a/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager/src/main/java/org/apache/hadoop/yarn/server/resourcemanager/scheduler/fair/AllocationConfiguration.java\n+++ b/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager/src/main/java/org/apache/hadoop/yarn/server/resourcemanager/scheduler/fair/AllocationConfiguration.java\n@@ -126,7 +126,7 @@ public AllocationConfiguration(Configuration conf) {\n     queueMaxAMShares = new HashMap<String, Float>();\n     userMaxAppsDefault = Integer.MAX_VALUE;\n     queueMaxAppsDefault = Integer.MAX_VALUE;\n-    queueMaxAMShareDefault = 1.0f;\n+    queueMaxAMShareDefault = -1.0f;\n     queueAcls = new HashMap<String, Map<QueueACL, AccessControlList>>();\n     minSharePreemptionTimeouts = new HashMap<String, Long>();\n     defaultMinSharePreemptionTimeout = Long.MAX_VALUE;\ndiff --git a/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager/src/main/java/org/apache/hadoop/yarn/server/resourcemanager/scheduler/fair/AllocationFileLoaderService.java b/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager/src/main/java/org/apache/hadoop/yarn/server/resourcemanager/scheduler/fair/AllocationFileLoaderService.java\nindex 064bdfc817..4cc88c140d 100644\n--- a/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager/src/main/java/org/apache/hadoop/yarn/server/resourcemanager/scheduler/fair/AllocationFileLoaderService.java\n+++ b/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager/src/main/java/org/apache/hadoop/yarn/server/resourcemanager/scheduler/fair/AllocationFileLoaderService.java\n@@ -221,7 +221,7 @@ public synchronized void reloadAllocations() throws IOException,\n         new HashMap<String, Map<QueueACL, AccessControlList>>();\n     int userMaxAppsDefault = Integer.MAX_VALUE;\n     int queueMaxAppsDefault = Integer.MAX_VALUE;\n-    float queueMaxAMShareDefault = 1.0f;\n+    float queueMaxAMShareDefault = -1.0f;\n     long fairSharePreemptionTimeout = Long.MAX_VALUE;\n     long defaultMinSharePreemptionTimeout = Long.MAX_VALUE;\n     SchedulingPolicy defaultSchedPolicy = SchedulingPolicy.DEFAULT_POLICY;\ndiff --git a/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager/src/main/java/org/apache/hadoop/yarn/server/resourcemanager/scheduler/fair/FSLeafQueue.java b/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager/src/main/java/org/apache/hadoop/yarn/server/resourcemanager/scheduler/fair/FSLeafQueue.java\nindex 21dbdc5fac..8f957382e6 100644\n--- a/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager/src/main/java/org/apache/hadoop/yarn/server/resourcemanager/scheduler/fair/FSLeafQueue.java\n+++ b/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-resourcemanager/src/main/java/org/apache/hadoop/yarn/server/resourcemanager/scheduler/fair/FSLeafQueue.java\n@@ -308,6 +308,9 @@ public ActiveUsersManager getActiveUsersManager() {\n   public boolean canRunAppAM(Resource amResource) {\n     float maxAMShare =\n         scheduler.getAllocationConfiguration().getQueueMaxAMShare(getName());\n+    if (Math.abs(maxAMShare - -1.0f) < 0.0001) {\n+      return true;\n+    }\n     Resource maxAMResource = Resources.multiply(getFairShare(), maxAMShare);\n     Resource ifRunAMResource = Resources.add(amResourceUsage, amResource);\n     return !policy\n",
  "files": 3,
  "linesAdd": 5,
  "linesRem": 2,
  "failing_tests": [
    "org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.TestFairScheduler.testQueueMaxAMShareDefault"
  ],
  "nb_test": 633,
  "nb_failure": 1,
  "nb_error": 0,
  "nb_skipped": 1
}