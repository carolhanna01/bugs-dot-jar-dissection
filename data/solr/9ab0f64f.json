{
  "project": "solr",
  "jira_id": "6117",
  "commit": "9ab0f64f",
  "classification": {
    "singleLine": false
  },
  "patch": "diff --git a/lucene/core/src/java/org/apache/lucene/index/DocumentsWriter.java b/lucene/core/src/java/org/apache/lucene/index/DocumentsWriter.java\nindex e3c357f142..11e25090de 100644\n--- a/lucene/core/src/java/org/apache/lucene/index/DocumentsWriter.java\n+++ b/lucene/core/src/java/org/apache/lucene/index/DocumentsWriter.java\n@@ -388,7 +388,7 @@ final class DocumentsWriter implements Closeable, Accountable {\n           writer.globalFieldNumberMap);\n       state.dwpt = new DocumentsWriterPerThread(writer.newSegmentName(),\n                                                 directory, config, infoStream, deleteQueue, infos,\n-                                                writer.pendingNumDocs);\n+                                                writer.pendingNumDocs, writer.enableTestPoints);\n     }\n   }\n \ndiff --git a/lucene/core/src/java/org/apache/lucene/index/DocumentsWriterPerThread.java b/lucene/core/src/java/org/apache/lucene/index/DocumentsWriterPerThread.java\nindex 053fbcaa7e..54d65ec135 100644\n--- a/lucene/core/src/java/org/apache/lucene/index/DocumentsWriterPerThread.java\n+++ b/lucene/core/src/java/org/apache/lucene/index/DocumentsWriterPerThread.java\n@@ -155,9 +155,10 @@ class DocumentsWriterPerThread {\n   final IntBlockPool.Allocator intBlockAllocator;\n   private final AtomicLong pendingNumDocs;\n   private final LiveIndexWriterConfig indexWriterConfig;\n+  private final boolean enableTestPoints;\n   \n   public DocumentsWriterPerThread(String segmentName, Directory directory, LiveIndexWriterConfig indexWriterConfig, InfoStream infoStream, DocumentsWriterDeleteQueue deleteQueue,\n-                                  FieldInfos.Builder fieldInfos, AtomicLong pendingNumDocs) throws IOException {\n+                                  FieldInfos.Builder fieldInfos, AtomicLong pendingNumDocs, boolean enableTestPoints) throws IOException {\n     this.directoryOrig = directory;\n     this.directory = new TrackingDirectoryWrapper(directory);\n     this.fieldInfos = fieldInfos;\n@@ -184,6 +185,7 @@ class DocumentsWriterPerThread {\n     // this should be the last call in the ctor \n     // it really sucks that we need to pull this within the ctor and pass this ref to the chain!\n     consumer = indexWriterConfig.getIndexingChain().getChain(this);\n+    this.enableTestPoints = enableTestPoints;\n   }\n   \n   public FieldInfos.Builder getFieldInfosBuilder() {\n@@ -191,7 +193,8 @@ class DocumentsWriterPerThread {\n   }\n \n   final void testPoint(String message) {\n-    if (infoStream.isEnabled(\"TP\")) {\n+    if (enableTestPoints) {\n+      assert infoStream.isEnabled(\"TP\"); // don't enable unless you need them.\n       infoStream.message(\"TP\", message);\n     }\n   }\ndiff --git a/lucene/core/src/java/org/apache/lucene/index/IndexWriter.java b/lucene/core/src/java/org/apache/lucene/index/IndexWriter.java\nindex 11a5261946..e06d0d5616 100644\n--- a/lucene/core/src/java/org/apache/lucene/index/IndexWriter.java\n+++ b/lucene/core/src/java/org/apache/lucene/index/IndexWriter.java\n@@ -215,6 +215,9 @@ public class IndexWriter implements Closeable, TwoPhaseCommit, Accountable {\n     return IndexWriter.actualMaxDocs;\n   }\n   \n+  /** Used only for testing. */\n+  boolean enableTestPoints = false;\n+\n   private static final int UNBOUNDED_MAX_MERGE_SEGMENTS = -1;\n   \n   /**\n@@ -4417,7 +4420,8 @@ public class IndexWriter implements Closeable, TwoPhaseCommit, Accountable {\n   //   startMergeInit\n   //   DocumentsWriter.ThreadState.init start\n   private final void testPoint(String message) {\n-    if (infoStream.isEnabled(\"TP\")) {\n+    if (enableTestPoints) {\n+      assert infoStream.isEnabled(\"TP\"); // don't enable unless you need them.\n       infoStream.message(\"TP\", message);\n     }\n   }\n",
  "files": 3,
  "linesAdd": 11,
  "linesRem": 4,
  "failing_tests": [],
  "nb_test": 0,
  "nb_failure": 0,
  "nb_error": 0,
  "nb_skipped": 0
}